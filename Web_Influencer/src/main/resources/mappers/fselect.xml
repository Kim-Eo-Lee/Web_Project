<?xml version="1.0" encoding="UTF-8"?>
<!-- mappers/hrm.xml -->
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                        
<mapper namespace="com.ssafy.happyhouse.dao.FSelectBoxMapper"> <!-- mybatis는 namespace필수!! -->
     
     
     <!--문명기 추가(0611)   -->
      <select id="selectDeal" resultType="com.ssafy.happyhouse.dto.HouseDealDTO" >
	    SELECT d.no,d.dong,d.AptName,d.code
	    ,d.dealAmount,d.buildYear,d.dealYear,d.dealMonth,d.dealDay,d.area,d.floor,d.jibun
	    <choose>
	        <when test="userid != null and userid != ''">, dibs.aptno</when>
	        <otherwise>, '' as aptno</otherwise>
	    </choose>
	    FROM housedeal as d
	    <if test="userid != null and userid != ''">
	        left outer join dibs
	        on dibs.userid = #{userid}
	        and d.no = dibs.aptno
	    </if>
	    WHERE d.dong= #{dong}
	    and (d.area BETWEEN #{minArea} AND #{maxArea})
	    ORDER BY d.AptName
	 </select>
     
     <!-- 검색창에 시,군,구 넣어도 관련 시,군,동 정보를 리턴함 -->
     <select id="findAddress" resultType="com.ssafy.happyhouse.dto.DongCodeDTO" >
		SELECT  dong_code as dongCode , dong_name as dongName FROM dongcode                                     
		where dong_name like CONCAT('%',#{address},'%')
		ORDER BY dong_code
     </select>
      <!--김지효 추가(0611)   -->
     <select id="selectDetail" resultType="com.ssafy.happyhouse.dto.HouseDealDTO" >
      SELECT no,dong,AptName,code,dealAmount,buildYear,dealYear,dealMonth,dealDay,area,floor,jibun,type FROM housedeal 
      WHERE no = #{no}                                   
     </select>
 	<select id="selectAll" resultType="com.ssafy.happyhouse.dto.HouseInfoDTO" >
		SELECT distinct i.lat, i.dong,i.AptName as aptname,i.code,i.lng
		FROM housedeal as d,houseInfo as i
		WHERE i.code = d.code
		and i.AptName = d.AptName 
		and (d.area BETWEEN #{minArea} AND #{maxArea}) 
		and (replace(d.dealAmount,",","") BETWEEN #{minDealAmount} AND #{maxDealAmount})                 
		ORDER BY AptName
		limit 500
     </select>
     <!-- 위치를 눌렀을떄 아파트 매매목록 나오게하기  -->
     <select id="selectDealDetail" resultType="com.ssafy.happyhouse.dto.HouseDealDTO" >
		SELECT d.no,d.dong,d.AptName as aptname ,d.code,d.dealAmount,d.buildYear,d.dealYear,d.dealMonth,d.dealDay,d.area,d.floor,d.jibun
		FROM housedeal as d
		WHERE d.code= #{code}   
		and d.AptName = #{aptname}
		and (d.area BETWEEN #{minArea} AND #{maxArea})
		and (replace(d.dealAmount,",","") BETWEEN #{minDealAmount} AND #{maxDealAmount})
		ORDER BY AptName
		limit 500
     </select>
     <select id="selectInBoundApt" resultType="com.ssafy.happyhouse.dto.HouseDealDTO" >
		SELECT d.no,d.dong,d.AptName,d.code,d.dealAmount,d.buildYear,d.dealYear,d.dealMonth,d.dealDay,d.area,d.floor,d.jibun
		,i.lat,i.lng
		FROM housedeal as d,houseInfo as i
		WHERE i.AptName = d.AptName   
		and (d.area BETWEEN #{minArea} AND #{maxArea}) 
		and (replace(d.dealAmount,",","") BETWEEN #{minDealAmount} AND #{maxDealAmount}) 
		and (i.lat  BETWEEN #{swLat} AND #{neLat} )   
		and (i.lng  BETWEEN #{neLat} AND #{neLng} )          
		ORDER BY AptName
		limit 50
     </select>
     <select id="selectAvg" resultType="com.ssafy.happyhouse.dto.GraphDTO" >
     	select dong, avg(dealAmount) as avg 
		from housedeal
		group by dong
		order by avg desc
		limit 5
     </select>
    <!-- <select id="selectInBoundApt" resultType="com.ssafy.happyhouse.dto.HouseDealDTO" >
		SELECT d.no,d.dong,d.AptName,d.code,d.dealAmount,d.buildYear,d.dealYear,d.dealMonth,d.dealDay,d.area,d.floor,d.jibun,
		d.lat,d.lng
		FROM housedeal as d    
		where (d.lat BETWEEN #{swLat} AND #{neLat} )   
		and (d.lng BETWEEN #{neLat} AND #{neLng} )        
		limit 500
     </select> -->
  <!-- 	<if test="title != null">
		 AND title like #{title}
		 </if> -->
  
</mapper>



